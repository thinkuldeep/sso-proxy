<!DOCTYPE html>
<html>
<head>
    <title>SSO - Get Job Posting At TW</title>
    <meta charset="utf-8">
    <meta name="description" content="Get Job Posting at Thoughtworks - Refer Portal">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link type="text/css" href="styles.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://unpkg.com/focus-visible@5.0.2/dist/focus-visible.js" defer></script>
</head>
<body>

<div class="topnav" id="myTopnav">
    <a href="index.html">Home</a>
    <a href="GetClaimHistory.html">MediAssist Portal</a>
    <a href="JobsAtTW.html" class="active">Jobs@TW</a>
    <a href="https://github.com/thinkuldeep/sso-proxy/" >Github Source</a>
    <a href="https://thinkuldeep.com/" >thinkuldeep.com</a>
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
        <i class="fa fa-bars"></i>
    </a>
</div>

<h3>Get Job Posting @ <a href="https://refer.recruiting.thoughtworks.net/"> Thoughtworks Refer Portal</a></h3>

<div id="loading" style="display: none; text-align:center;">
    <div class="spinner"></div>
</div>

<table id="dataTable" class="display">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>City</th>
        <th>Country</th>
    </tr>
    </thead>
    <tfoot>
    <tr>
        <th><input type="text" placeholder="Search ID"/></th>
        <th><input type="text" placeholder="Search Title"/></th>
        <th><input type="text" placeholder="Search City"/></th>
        <th><input type="text" placeholder="Search Country"/></th>
    </tr>
    </tfoot>
    <tbody></tbody>
</table>

<div class="row">
    <p>Make sure the proxy is running at <a href="http://localhost:3001/sso-proxy">http://localhost:3001/sso-proxy</a>.
        Refer Guide <a href="https://github.com/thinkuldeep/sso-proxy/blob/main/README.md"> here </a> </p>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script >
    const PROXY_URL = 'http://localhost:3001/sso-proxy';
    const SSO_URL = 'https://refer.recruiting.thoughtworks.net/';
    const API_URL_GET_JOBS = 'https://refer.recruiting.thoughtworks.net/api/job-posts';

    var table;

    function drawTable() {
        table.clear().draw();
        renderTable();
    }

    async function renderTable() {
        $('#loading').show();
        try {
            const response = await fetch(`${PROXY_URL}?url=${API_URL_GET_JOBS}&ssoUrl=${SSO_URL}`);
            const jsonData = (await response.json()) || [];
            jsonData.forEach(row => {
                table.row.add(row).draw();
            });
        } catch (error) {
            console.error(error);
        }
        $('#loading').hide();
    }

    $(document).ready(function() {

        table = $('#dataTable').DataTable({
            columns: [
                {data: 'job_id'},
                {data: 'title'},
                {data: 'city'},
                {data: 'country'}
            ],
            order: [[1, 'asc']]
        });

        // Apply column search
        $('#dataTable tfoot input').on('keyup change', function () {
            const index = $(this).parent().index();
            table.column(index).search(this.value).draw();
        });

        drawTable();
    });
</script>
<script src="script.js"></script>
</body>
</html>
